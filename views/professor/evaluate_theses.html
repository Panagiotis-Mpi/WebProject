<div id="gradesForm" style="display:none;">
    <label>Βαθμός Περιεχομένου (0-10):</label>
    <input type="number" id="contentScore" min="0" max="10" step="0.01">
    <label>Βαθμός Οργάνωσης (0-10):</label>
    <input type="number" id="organizationScore" min="0" max="10" step="0.01">
    <label>Βαθμός Παρουσίασης (0-10):</label>
    <input type="number" id="presentationScore" min="0" max="10" step="0.01">
    <button id="submitGradeBtn">Καταχώρηση Βαθμού</button>

    <h3>Βαθμολογίες άλλων καθηγητών:</h3>
    <table id="gradesTable" border="1" style="width:100%; margin-top:0.5rem; border-collapse: collapse;">
        <thead>
            <tr>
                <th>Καθηγητής</th>
                <th>Περιεχόμενο</th>
                <th>Οργάνωση</th>
                <th>Παρουσίαση</th>
                <th>Τελικός Βαθμός</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
const thesisSelect=document.getElementById('thesisSelect');
const gradesForm=document.getElementById('gradesForm');
const gradesTableBody=document.querySelector('#gradesTable tbody');

// Φόρτωση διπλωματικών
fetch('../../api/professor/get_theses_to_evaluate.php')
.then(res=>res.json())
.then(data=>{
    if(!data.success){ alert(data.message); return; }
    data.theses.forEach(t=>{
        const option=document.createElement('option');
        option.value=t.id;
        option.textContent=t.topic_title + " ("+t.first_name+" "+t.last_name+")";
        thesisSelect.appendChild(option);
    });
    if(data.theses.length>0) gradesForm.style.display='block';
    loadGradesForSelectedThesis();
});

// Όταν αλλάζει η επιλογή διπλωματικής
thesisSelect.addEventListener('change',loadGradesForSelectedThesis);

function loadGradesForSelectedThesis(){
    const thesis_id=thesisSelect.value;
    if(!thesis_id) return;
    fetch(`../../api/professor/get_grades_for_thesis.php?thesis_id=${thesis_id}`)
    .then(res=>res.json())
    .then(data=>{
        if(!data.success){ alert(data.message); return; }
        gradesTableBody.innerHTML='';
        data.grades.forEach(g=>{
            const tr=document.createElement('tr');
            tr.innerHTML=`<td>${g.first_name} ${g.last_name}</td>
                            <td>${g.content_score}</td>
                            <td>${g.organization_score}</td>
                            <td>${g.presentation_score}</td>
                            <td>${g.final_grade}</td>`;
            gradesTableBody.appendChild(tr);
        });
    });
}

// Καταχώρηση βαθμού
document.getElementById('submitGradeBtn').addEventListener('click',()=>{
    const thesis_id=thesisSelect.value;
    const contentScore=parseFloat(document.getElementById('contentScore').value);
    const organizationScore=parseFloat(document.getElementById('organizationScore').value);
    const presentationScore=parseFloat(document.getElementById('presentationScore').value);

    if(isNaN(contentScore) || isNaN(organizationScore) || isNaN(presentationScore)){
        alert("⚠️ Συμπληρώστε όλους τους βαθμούς!");
        return;
    }

    fetch('../../api/professor/submit_grade.php',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({thesis_id, content_score:contentScore, organization_score:organizationScore, presentation_score:presentationScore})
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            alert("✅ "+data.message);
            loadGradesForSelectedThesis(); // Ενημέρωση πίνακα
        } else { alert("❌ "+data.message); }
    });
});

// Επιστροφή στο Dashboard
document.getElementById('backBtn').addEventListener('click',()=>{ window.location.href='professor_dashboard.html'; });
</script>
