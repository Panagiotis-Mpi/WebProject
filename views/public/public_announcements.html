<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ανακοινώσεις Παρουσιάσεων Διπλωματικών</title>
<link rel="stylesheet" href="../../assets/css/professor/assign_topic.css">
</head>
<body>

<header>
    <img src="../../assets/img/ceid.png" alt="CEID Logo" class="logo">
    <h1>Ανακοινώσεις Παρουσιάσεων Διπλωματικών</h1>
</header>

<main>
    <div class="container">
        <label for="startDate">Από Ημερομηνία:</label>
        <input type="date" id="startDate">

        <label for="endDate">Έως Ημερομηνία:</label>
        <input type="date" id="endDate">

        <label for="formatSelect">Μορφή Εξόδου:</label>
        <select id="formatSelect">
            <option value="json">JSON</option>
            <option value="xml">XML</option>
        </select>

        <button id="loadBtn">Φόρτωση Ανακοινώσεων</button>

        <div id="announcements" style="margin-top:1.5rem;"></div>

        <!-- Κουμπί πίσω -->
        <button class="back-btn" id="backBtn">Πίσω</button>
    </div>
</main>

<footer>
    <p>&copy; 2025 Πανεπιστήμιο Πατρών - Πλατφόρμα Διπλωματικών - Τμήμα Μηχανικών Η/Υ & Πληροφορικής</p>
</footer>

<script>
// Φόρτωση ανακοινώσεων
document.getElementById('loadBtn').addEventListener('click', () => {
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    const format = document.getElementById('formatSelect').value;

    if (!start || !end) {
        alert("Επιλέξτε και τις δύο ημερομηνίες!");
        return;
    }

    fetch(`../../api/public/announcements.php?start=${start}&end=${end}&format=${format}`)
        .then(res => res.text())
        .then(data => {
            const container = document.getElementById('announcements');
            if (format === "json") {
                try {
                    const parsed = JSON.parse(data);
                    if (parsed.success) {
                        let html = "<h3>Ανακοινώσεις</h3><ul>";
                        parsed.announcements.forEach(a => {
                            html += `<li><strong>${a.title}</strong> - ${a.date} (${a.location})</li>`;
                        });
                        html += "</ul>";
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = `<p style="color:red">${parsed.message}</p>`;
                    }
                } catch {
                    container.innerHTML = "<p style='color:red'>Σφάλμα ανάλυσης JSON.</p>";
                }
            } else {
                // Εμφάνιση XML ως απλό κείμενο
                container.innerHTML = `<pre>${data}</pre>`;
            }
        })
        .catch(() => {
            document.getElementById('announcements').innerHTML = "<p style='color:red'>Σφάλμα επικοινωνίας με τον server.</p>";
        });
});

// Επιστροφή στην αρχική
document.getElementById('backBtn').addEventListener('click', () => {
    window.location.href = "../../views/auth/login.html";
});
</script>

</body>
</html>
