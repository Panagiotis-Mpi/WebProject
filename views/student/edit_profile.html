<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Επεξεργασία Προφίλ</title>
<style>
body { font-family: Arial; max-width: 600px; margin: auto; padding: 1rem; }
h2 { text-align: center; }
form { display: flex; flex-direction: column; }
label { margin-top: 1rem; font-weight: bold; }
input { padding: 0.5rem; border: 1px solid #ccc; border-radius: 5px; }
button { margin-top: 1rem; padding: 0.7rem; border: none; border-radius: 5px; background: #4CAF50; color: white; cursor: pointer; }
button:hover { background: #45a049; }
#message { margin-top: 1rem; font-weight: bold; }
</style>
</head>
<body>
<h2>Επεξεργασία Προφίλ</h2>
<form id="profileForm">
    <label>Αριθμός Μητρώου (ΑΜ):</label>
    <input type="text" id="am" readonly>

    <label>Email:</label>
    <input type="email" id="email" readonly>

    <label>Όνομα:</label>
    <input type="text" id="first_name" required>

    <label>Επώνυμο:</label>
    <input type="text" id="last_name" required>

    <label>Τηλέφωνο:</label>
    <input type="text" id="phone">

    <label>Νέος Κωδικός (προαιρετικό):</label>
    <input type="password" id="password">

    <button type="submit">Αποθήκευση</button>
</form>

<div id="message"></div>

<button onclick="window.location.href='student_dashboard.html'">Επιστροφή στο Dashboard</button>

<script>
// Φόρτωση στοιχείων φοιτητή
window.onload = function() {
    fetch("../../api/student/get_profile.php")
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById("am").value = data.user.am;
            document.getElementById("email").value = data.user.email;
            document.getElementById("first_name").value = data.user.first_name;
            document.getElementById("last_name").value = data.user.last_name;
            document.getElementById("phone").value = data.user.phone || "";
        } else {
            document.getElementById("message").textContent = "Σφάλμα φόρτωσης προφίλ.";
            document.getElementById("message").style.color = "red";
        }
    });
};

// Αποθήκευση αλλαγών
document.getElementById("profileForm").addEventListener("submit", function(e){
    e.preventDefault();

    const data = {
        first_name: document.getElementById("first_name").value,
        last_name: document.getElementById("last_name").value,
        phone: document.getElementById("phone").value,
        password: document.getElementById("password").value
    };

    fetch("../../api/student/update_profile.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(resp => {
        const msg = document.getElementById("message");
        msg.textContent = resp.message;
        msg.style.color = resp.success ? "green" : "red";
    });
});
</script>
</body>
</html>

