<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î˜Î­Î¼Î±Ï„Î±</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        ul { list-style-type: none; padding: 0; }
        li { margin-bottom: 20px; border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
        .taken { color: red; font-weight: bold; }
        .available { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î˜Î­Î¼Î±Ï„Î± Î”Î¹Ï€Î»Ï‰Î¼Î±Ï„Î¹ÎºÏÎ½</h1>
    
    <?php if ($error): ?><p style="color:red;"><?= htmlspecialchars($error) ?></p><?php endif; ?>
    <?php if ($success): ?><p style="color:green;"><?= htmlspecialchars($success) ?></p><?php endif; ?>

    <p id="message"></p>
    <div id="topics-container">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î¸ÎµÎ¼Î¬Ï„Ï‰Î½...</div>
    <p><a href="dashboard.php">â† Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®</a></p>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const topicsContainer = document.getElementById('topics-container');
            const messageElement = document.getElementById('message');

            fetch('../api/get_topics.php')
                .then(response => response.json())
                .then(topics => {
                    if (topics.error) {
                        topicsContainer.innerHTML = `<p style="color:red;">Î£Ï†Î¬Î»Î¼Î± API: ${topics.error}</p>`;
                        return;
                    }
                    if (topics.length === 0) {
                        topicsContainer.innerHTML = `<p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î¸Î­Î¼Î±Ï„Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.</p>`;
                        return;
                    }

                    let hasThesis = <?= json_encode($has_thesis); ?>;
                    if (hasThesis) {
                        messageElement.innerHTML = `<p style="color:red;">ÎˆÏ‡ÎµÏ„Îµ Î®Î´Î· ÎµÎ½ÎµÏÎ³Î® Î® Ï…Ï€ÏŒ Î±Î½Î¬Î¸ÎµÏƒÎ· Î´Î¹Ï€Î»Ï‰Î¼Î±Ï„Î¹ÎºÎ®. Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Î½Î­Î¿ Î¸Î­Î¼Î±.</p>`;
                    }

                    let html = '<ul>';
                    topics.forEach(topic => {
                        const statusClass = topic.is_taken > 0 ? 'taken' : 'available';
                        const statusText = topic.is_taken > 0 ? 'Î”ÎµÏƒÎ¼ÎµÏ…Î¼Î­Î½Î¿' : 'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿';
                        
                        const actionButton = (topic.is_taken > 0 || hasThesis) ? '' : `
                            <form method="post">
                                <input type="hidden" name="topic_id" value="${topic.id}">
                                <button type="submit">Î‘Î¯Ï„Î·ÏƒÎ· Î‘Î½Î¬Î¸ÎµÏƒÎ·Ï‚</button>
                            </form>
                        `;

                        const pdfLink = topic.pdf_path ? `<a href="${topic.pdf_path}" target="_blank">ğŸ“„ Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÎ® Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</a>` : '';

                        html += `
                            <li>
                                <strong>${topic.title}</strong><br>
                                ${topic.summary.replace(/\\n/g, '<br>')}<br>
                                Î•Ï€Î¹Î²Î»Î­Ï€Ï‰Î½: ${topic.first_name} ${topic.last_name}<br>
                                ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: <span class="${statusClass}">${statusText}</span>
                                ${actionButton}
                                <br>
                                ${pdfLink}
                            </li>
                            <hr>
                        `;
                    });
                    html += '</ul>';
                    topicsContainer.innerHTML = html;
                })
                .catch(error => {
                    topicsContainer.innerHTML = `<p style="color:red;">Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Î¬ÎºÏ„Î·ÏƒÎ· Ï„Ï‰Î½ Î¸ÎµÎ¼Î¬Ï„Ï‰Î½. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.</p>`;
                    console.error('Fetch error:', error);
                });
        });
    </script>
</body>
</html>
