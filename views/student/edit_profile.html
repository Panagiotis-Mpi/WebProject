<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Επεξεργασία Προφίλ</title>
<style>
body { font-family: Arial; max-width: 800px; margin: auto; padding: 1rem; }
h2 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
th { background-color: #f2f2f2; }
input { width: 100%; padding: 5px; border: none; background: transparent; }
input:read-only { background: #f9f9f9; color: #555; }
button { margin-top: 1rem; padding: 0.7rem; border: none; border-radius: 5px; background: #4CAF50; color: white; cursor: pointer; width: 100%; }
button:hover { background: #45a049; }
#message { margin-top: 1rem; font-weight: bold; }
</style>
</head>
<body>
<h2>Επεξεργασία Προφίλ</h2>

<table>
    <tr><th>Αριθμός Μητρώου (AM)</th><td><input type="text" id="am" readonly></td></tr>
    <tr><th>Email</th><td><input type="email" id="email" readonly></td></tr>
    <tr><th>Όνομα</th><td><input type="text" id="first_name"></td></tr>
    <tr><th>Επώνυμο</th><td><input type="text" id="last_name"></td></tr>
    <tr><th>Τηλέφωνο</th><td><input type="text" id="phone"></td></tr>
    <tr><th>Νέος Κωδικός</th><td><input type="password" id="password" placeholder="(προαιρετικό)"></td></tr>
</table>

<button onclick="updateProfile()">Αποθήκευση αλλαγών</button>
<div id="message"></div>

<button onclick="window.location.href='student_dashboard.html'">Επιστροφή στο Dashboard</button>

<script>
// Φόρτωση στοιχείων φοιτητή
window.onload = function() {
    fetch("../../api/student/get_profile.php")
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById("am").value = data.user.am;
            document.getElementById("email").value = data.user.email;
            document.getElementById("first_name").value = data.user.first_name;
            document.getElementById("last_name").value = data.user.last_name;
            document.getElementById("phone").value = data.user.phone || "";
        } else {
            document.getElementById("message").textContent = "Σφάλμα φόρτωσης προφίλ.";
            document.getElementById("message").style.color = "red";
        }
    });
};

// Αποθήκευση αλλαγών
function updateProfile(){
    const data = {
        first_name: document.getElementById("first_name").value,
        last_name: document.getElementById("last_name").value,
        phone: document.getElementById("phone").value,
        password: document.getElementById("password").value
    };

    fetch("../../api/student/update_profile.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(resp => {
        const msg = document.getElementById("message");
        msg.textContent = resp.message;
        msg.style.color = resp.success ? "green" : "red";
    });
}
</script>
</body>
</html>
