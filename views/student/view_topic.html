<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Προβολή Θέματος</title>
<link rel="stylesheet" href="../../assets/css/student/view_topic.css">
</head>
<body>

<header>
    <img src="../../assets/img/ceid.png" alt="CEID Logo" class="logo">
    <h1>Προβολή Θέματος</h1>
    <button class="logout-btn" onclick="logout()">Αποσύνδεση</button>
</header>

<main>
    <div class="container" id="topicDetails">Φόρτωση...</div>
    <button class="back-btn" onclick="window.location.href='student_dashboard.html'">⬅️ Πίσω</button>
</main>

<footer>
    <p>&copy; 2025 Πανεπιστήμιο Πατρών - Πλατφόρμα Διπλωματικών</p>
</footer>

<script>
function logout(){
    fetch('../../api/auth/logout.php')
        .then(res => res.json())
        .then(data => {
            if(data.success) window.location.href='../auth/login.html';
            else alert('Σφάλμα κατά την αποσύνδεση');
        })
        .catch(() => alert('Σφάλμα επικοινωνίας με τον server'));
}

// Φόρτωση δεδομένων θέματος
fetch('../../api/student/get_student_topic.php')
.then(res => res.json())
.then(data => {
    const div = document.getElementById('topicDetails');
    if(!data.success){
        div.innerHTML = "<p style='color:red'>" + data.message + "</p>";
        return;
    }

    let html = `
        <h2>${data.topic.title}</h2>
        <p><strong>Περιγραφή:</strong> ${data.topic.summary}</p>
    `;

    if(data.topic.pdf_path){
        html += `<p><strong>Αρχείο PDF:</strong> <a href="${data.topic.pdf_path}" target="_blank">Λήψη PDF</a></p>`;
    }

    if(data.thesis){
        html += `<p><strong>Κατάσταση Διπλωματικής:</strong> ${data.thesis.status}</p>`;
        if(data.thesis.assignment_date){
            html += `<p><strong>Ημέρες από ανάθεση:</strong> ${data.days_since_assignment} ημέρες</p>`;
        }
    }

    if(data.committee && data.committee.length > 0){
        html += "<h3>Τριμελής Επιτροπή</h3><ul>";
        data.committee.forEach(m => {
            html += `<li>${m.first_name} ${m.last_name} (${m.role}, ${m.status})</li>`;
        });
        html += "</ul>";
    }

    div.innerHTML = html;
})
.catch(err=>{
    document.getElementById('topicDetails').innerHTML = "<p style='color:red'>Σφάλμα φόρτωσης.</p>";
});
</script>
</body>
</html>

