<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Επεξεργασία Προφίλ</title>
<link rel="stylesheet" href="../../assets/css/student/edit_profile.css">
</head>
<body>
<header>
    <img src="../../assets/img/ceid.png" alt="CEID Logo" class="logo">
    <h1>Επεξεργασία Προφίλ</h1>
    <button class="logout-btn" onclick="logout()">Αποσύνδεση</button>
</header>

<main>
    <div class="profile-container">
        <h2>Επεξεργασία Προφίλ</h2>
        <table>
            <tr><th>Αριθμός Μητρώου (AM)</th><td><input type="text" id="am" readonly></td></tr>
            <tr><th>Email</th><td><input type="email" id="email" readonly></td></tr>
            <tr><th>Όνομα</th><td><input type="text" id="first_name"></td></tr>
            <tr><th>Επώνυμο</th><td><input type="text" id="last_name"></td></tr>
            <tr><th>Τηλέφωνο</th><td><input type="text" id="phone"></td></tr>
            <tr><th>Νέος Κωδικός</th><td><input type="password" id="password" placeholder="(προαιρετικό)"></td></tr>
        </table>

        <button class="save-btn" onclick="updateProfile()">Αποθήκευση αλλαγών</button>
        <div id="message"></div>
    </div>

    <button class="back-btn" onclick="window.location.href='student_dashboard.html'">Πίσω</button>
</main>

<footer>
    <p>&copy; 2025 Πανεπιστήμιο Πατρών - Πλατφόρμα Διπλωματικών - Τμήμα Μηχανικών Η/Υ & Πληροφορικής</p>
</footer>

<script>
function logout(){
    fetch('../../api/auth/logout.php')
        .then(() => window.location.href = '../auth/login.html');
}

// Φόρτωση στοιχείων φοιτητή
window.onload = function() {
    fetch("../../api/student/get_profile.php")
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById("am").value = data.user.am;
            document.getElementById("email").value = data.user.email;
            document.getElementById("first_name").value = data.user.first_name;
            document.getElementById("last_name").value = data.user.last_name;
            document.getElementById("phone").value = data.user.phone || "";
        } else {
            const msg = document.getElementById("message");
            msg.textContent = "Σφάλμα φόρτωσης προφίλ.";
            msg.style.color = "red";
        }
    });
};

// Αποθήκευση αλλαγών
function updateProfile(){
    const data = {
        first_name: document.getElementById("first_name").value,
        last_name: document.getElementById("last_name").value,
        phone: document.getElementById("phone").value,
        password: document.getElementById("password").value
    };

    fetch("../../api/student/update_profile.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(resp => {
        const msg = document.getElementById("message");
        msg.textContent = resp.message;
        msg.style.color = resp.success ? "green" : "red";
    });
}
</script>
</body>
</html>
