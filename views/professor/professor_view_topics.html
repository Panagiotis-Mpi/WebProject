<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Τα Θέματά μου</title>
    <link rel="stylesheet" href="../styles.css"> <!-- Προαιρετικό CSS -->
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #topics-list div { padding: 10px; border-bottom: 1px solid #ccc; cursor: pointer; }
        #topics-list div:hover { background-color: #f0f0f0; }
        #topic-modal {
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            background: white; 
            padding: 30px; 
            border: 1px solid #333; 
            z-index: 1000;
            width: 80%; 
            max-width: 900px; 
            max-height: 90%; 
            overflow-y: auto; 
        }
        #topic-modal.hidden { display: none; }
        #modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; z-index: 999; 
        }
        label { font-weight: bold; }
        input, textarea { width: 100%; }
        button { margin-top: 10px; margin-right: 10px; }
    </style>
</head>
<body>
    <h1>Τα Θέματά μου</h1>
    <div id="topics-list">Φόρτωση θεμάτων...</div>

    <div id="modal-overlay"></div>

    <!-- Modal για λεπτομέρειες και τροποποίηση -->
    <div id="topic-modal" class="hidden">
        <h2>Λεπτομέρειες Θέματος</h2>
        <form id="topic-form">
            <input type="hidden" id="topic-id">
            <label>Τίτλος:</label>
            <input type="text" id="topic-title" required><br><br>
            <label>Περίληψη:</label><br>
            <textarea id="topic-summary" rows="8" required></textarea><br><br>
            <label>PDF:</label>
            <input type="text" id="topic-pdf"><br><br>
            <button type="submit">Αποθήκευση Αλλαγών</button>
            <button type="button" id="close-modal">Κλείσιμο</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const topicsList = document.getElementById('topics-list');
            const modal = document.getElementById('topic-modal');
            const overlay = document.getElementById('modal-overlay');
            const topicForm = document.getElementById('topic-form');

            // Fetch των θεμάτων μέσω AJAX
            fetch('../../api/professor/get_professor_topics.php')
            .then(res => res.json())
            .then(data => {
                if(data.success){
                    topicsList.innerHTML = '';
                    data.topics.forEach(topic => {
                        const div = document.createElement('div');
                        div.textContent = topic.title;
                        div.dataset.id = topic.id;
                        div.dataset.title = topic.title;
                        div.dataset.summary = topic.summary;
                        div.dataset.pdf = topic.pdf_path;
                        div.addEventListener('click', () => openModal(div));
                        topicsList.appendChild(div);
                    });
                } else {
                    topicsList.textContent = 'Σφάλμα φόρτωσης θεμάτων';
                }
            });

            function openModal(div){
                document.getElementById('topic-id').value = div.dataset.id;
                document.getElementById('topic-title').value = div.dataset.title;
                document.getElementById('topic-summary').value = div.dataset.summary;
                document.getElementById('topic-pdf').value = div.dataset.pdf;
                modal.classList.remove('hidden');
                overlay.style.display = 'block';
            }

            document.getElementById('close-modal').addEventListener('click', () => {
                modal.classList.add('hidden');
                overlay.style.display = 'none';
            });

            topicForm.addEventListener('submit', e => {
                e.preventDefault();
                const topicId = document.getElementById('topic-id').value;
                const title = document.getElementById('topic-title').value;
                const summary = document.getElementById('topic-summary').value;
                const pdf = document.getElementById('topic-pdf').value;

                fetch('../../api/professor/update_topic.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({id: topicId, title, summary, pdf})
                })
                .then(res => res.json())
                .then(resp => {
                    if(resp.success){
                        alert('Το θέμα ενημερώθηκε επιτυχώς!');
                        modal.classList.add('hidden');
                        overlay.style.display = 'none';
                        location.reload();
                    } else {
                        alert('Σφάλμα κατά την ενημέρωση: ' + resp.message);
                    }
                });
            });
        });
    </script>
</body>
</html>
